<template>
  <div>
    <h3>vue-ueditor-wrapï¼šåŸºäºç™¾åº¦UEditor</h3>
    <p class="link-btns">
      <a href="https://ueditor.baidu.com/website/onlinedemo.html" target="_blank">å®˜ç½‘å®ä¾‹</a>
      <a href="https://ueditor.baidu.com/doc/" target="_blank">å®˜ç½‘APIæ–‡æ¡£</a>
      <a href="/static/UEditor/index.html">å®˜ç½‘å®ä¾‹</a>

      <a href="https://github.com/HaoChuan9421/vue-ueditor-wrap" target="_blank">GitHub</a>
      <a href="https://github.com/HaoChuan9421/vue-ueditor-wrap-demo" target="_blank">Vue-Demo</a>
    </p>
    <button @click="getContent">è·å–å†…å®¹</button>
    <div style="width: 60%;margin: 20px auto;">
      <vue-ueditor-wrap name="ueditor" ref="ueditors" v-model="msg" :config="myConfig" @ready="ready"
                        @beforeInit="addCustomButtom"></vue-ueditor-wrap>
    </div>

    <h3>å¾®ä¿¡è¡¨æƒ…</h3>
    <div style="width: 500px;margin: 20px auto;">
      <vue-ueditor-wrap name="ueditor2" ref="ueditors2" v-model="msg2" :config="myConfig2"
                        @ready="ready2"></vue-ueditor-wrap>
    </div>
  </div>
</template>

<!--
1ã€å®‰è£…æ’ä»¶ï¼šcnpm install vue-ueditor-wrap -S
2ã€ä¸‹è½½UEditorè‡³staticï¼šhttps://github.com/HaoChuan9421/vue-ueditor-wrap/tree/master/public/UEditor
  æˆ–ç›´æ¥æŸ¥çœ‹vueé¡¹ç›®demoï¼šhttps://github.com/HaoChuan9421/vue-ueditor-wrap-demo
-->

<script>
  import VueUeditorWrap from 'vue-ueditor-wrap'

  export default {
    name: "BaiduUEditor",
    components: {
      VueUeditorWrap
    },
    data() {
      return {
        arr: ['[å¾®ç¬‘]', '[æ’‡å˜´]', '[è‰²]', '[å‘å‘†]', '[å¾—æ„]', '[æµæ³ª]', '[å®³ç¾]', '[é—­å˜´]', '[ç¡]', '[å¤§å“­]', '[å°´å°¬]', '[å‘æ€’]', '[è°ƒçš®]', '[å‘²ç‰™]', '[æƒŠè®¶]', '[éš¾è¿‡]', '[å›§]', '[æŠ“ç‹‚]', '[å]', '[å·ç¬‘]', '[æ„‰å¿«]', '[ç™½çœ¼]', '[å‚²æ…¢]', '[å›°]', '[æƒŠæ]', '[æµæ±—]', '[æ†¨ç¬‘]', '[æ‚ é—²]', '[å¥‹æ–—]', '[å’’éª‚]', '[ç–‘é—®]', '[å˜˜]', '[æ™•]', '[è¡°]', '[éª·é«…]', '[æ•²æ‰“]', '[å†è§]', '[æ“¦æ±—]', '[æŠ é¼»]', '[é¼“æŒ]', '[åç¬‘]', '[å·¦å“¼å“¼]', '[å³å“¼å“¼]', '[å“ˆæ¬ ]', '[é„™è§†]', '[å§”å±ˆ]', '[å¿«å“­äº†]', '[é˜´é™©]', '[äº²äº²]', '[å¯æ€œ]', '[èœåˆ€]', '[è¥¿ç“œ]', '[å•¤é…’]', '[å’–å•¡]', '[çŒªå¤´]', '[ç«ç‘°]', '[å‡‹è°¢]', '[å˜´å”‡]', '[çˆ±å¿ƒ]', '[å¿ƒç¢]', '[è›‹ç³•]', '[ç‚¸å¼¹]', '[ä¾¿ä¾¿]', '[æœˆäº®]', '[å¤ªé˜³]', '[æ‹¥æŠ±]', '[å¼º]', '[å¼±]', '[æ¡æ‰‹]', '[èƒœåˆ©]', '[æŠ±æ‹³]', '[å‹¾å¼•]', '[æ‹³å¤´]', '[OK]', '[è·³è·³]', '[å‘æŠ–]', '[æ€„ç«]', '[è½¬åœˆ]', 'ğŸ˜„', 'ğŸ˜·', 'ğŸ˜‚', 'ğŸ˜', 'ğŸ˜³', 'ğŸ˜±', 'ğŸ˜”', 'ğŸ˜’', '[å˜¿å“ˆ]', '[æ‚è„¸]', '[å¥¸ç¬‘]', '[æœºæ™º]', '[çš±çœ‰]', '[è€¶]', 'ğŸ‘»', 'ğŸ™', 'ğŸ’ª', 'ğŸ‰', '[ç¤¼ç‰©]', '[çº¢åŒ…]', '[é¸¡]'],
        msg: '<h2><img src="http://img.baidu.com/hi/jx2/j_0003.gif"/>Vue + UEditor + v-modelåŒå‘ç»‘å®š</h2>',
        myConfig: {
          //æ‰“å¼€å³é”®èœå•åŠŸèƒ½
          enableContextMenu: false,

          // ç¼–è¾‘å™¨ä¸è‡ªåŠ¨è¢«å†…å®¹æ’‘é«˜
          // autoHeightEnabled: false,
          // åˆå§‹å®¹å™¨é«˜åº¦
          initialFrameHeight: 300,
          // // åˆå§‹å®¹å™¨å®½åº¦
          // initialFrameWidth: '100%',
          // ä¸Šä¼ æ–‡ä»¶æ¥å£ï¼ˆè¿™ä¸ªåœ°å€æ˜¯æˆ‘ä¸ºäº†æ–¹ä¾¿å„ä½ä½“éªŒæ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æ­å»ºçš„ä¸´æ—¶æ¥å£ï¼Œè¯·å‹¿åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼ï¼ï¼ï¼‰
          serverUrl: '',//http://35.201.165.105:8000/controller.php
          // UEditor èµ„æºæ–‡ä»¶çš„å­˜æ”¾è·¯å¾„ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯ vue-cli ç”Ÿæˆçš„é¡¹ç›®ï¼Œé€šå¸¸ä¸éœ€è¦è®¾ç½®è¯¥é€‰é¡¹ï¼Œvue-ueditor-wrap ä¼šè‡ªåŠ¨å¤„ç†å¸¸è§çš„æƒ…å†µï¼Œå¦‚æœéœ€è¦ç‰¹æ®Šé…ç½®ï¼Œå‚è€ƒä¸‹æ–¹çš„å¸¸è§é—®é¢˜2
          // UEDITOR_HOME_URL: '/vue-editor/static/UEditor/'
        },
        baiduEdit: {},

        msg2: 'å•¦å•¦å•¦å•¦ï¼Œæˆ‘çš„å…¬ä¼—å·[å¾®ç¬‘][æ’‡å˜´][è‰²][å‘å‘†][å¾—æ„][æµæ³ª][å®³ç¾][é—­å˜´][ç¡][å¤§å“­][å°´å°¬][å‘æ€’][è°ƒçš®][å‘²ç‰™][æƒŠè®¶][éš¾è¿‡][å›§][æŠ“ç‹‚][å][å·ç¬‘][æ„‰å¿«][ç™½çœ¼][å‚²æ…¢][å›°][æƒŠæ][æµæ±—][æ†¨ç¬‘][æ‚ é—²][å¥‹æ–—][å’’éª‚][ç–‘é—®][å˜˜][æ™•][è¡°][éª·é«…][æ•²æ‰“][å†è§][æ“¦æ±—][æŠ é¼»][é¼“æŒ][åç¬‘][å·¦å“¼å“¼][å³å“¼å“¼][å“ˆæ¬ ][é„™è§†][å§”å±ˆ][å¿«å“­äº†][é˜´é™©][äº²äº²][å¯æ€œ][èœåˆ€][è¥¿ç“œ][å•¤é…’][å’–å•¡][çŒªå¤´][ç«ç‘°][å‡‹è°¢][å˜´å”‡][çˆ±å¿ƒ][å¿ƒç¢][è›‹ç³•][ç‚¸å¼¹][ä¾¿ä¾¿][æœˆäº®][å¤ªé˜³][æ‹¥æŠ±][å¼º][å¼±][æ¡æ‰‹][èƒœåˆ©][æŠ±æ‹³][å‹¾å¼•][æ‹³å¤´][OK][è·³è·³][å‘æŠ–][æ€„ç«][è½¬åœˆ]ğŸ˜„ğŸ˜·ğŸ˜‚ğŸ˜ğŸ˜³ğŸ˜±ğŸ˜”ğŸ˜’[å˜¿å“ˆ][æ‚è„¸][å¥¸ç¬‘][æœºæ™º][çš±çœ‰][è€¶]ğŸ‘»ğŸ™ğŸ’ªğŸ‰[ç¤¼ç‰©][çº¢åŒ…][é¸¡]',
        // msg2: 'å•¦å•¦å•¦å•¦ï¼Œæˆ‘çš„å…¬ä¼—å·[å¾®ç¬‘]',
        myConfig2: {
          toolbars: [
            ['emotion']
          ],
          //æ‰“å¼€å³é”®èœå•åŠŸèƒ½
          enableContextMenu: false,
          //æ˜¯å¦è‡ªåŠ¨é•¿é«˜,é»˜è®¤true
          autoHeightEnabled: false,

          // ç¼–è¾‘å™¨ä¸è‡ªåŠ¨è¢«å†…å®¹æ’‘é«˜
          // autoHeightEnabled: false,
          // åˆå§‹å®¹å™¨é«˜åº¦
          initialFrameHeight: 300,
          // // åˆå§‹å®¹å™¨å®½åº¦
          // initialFrameWidth: '100%',
          // ä¸Šä¼ æ–‡ä»¶æ¥å£ï¼ˆè¿™ä¸ªåœ°å€æ˜¯æˆ‘ä¸ºäº†æ–¹ä¾¿å„ä½ä½“éªŒæ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æ­å»ºçš„ä¸´æ—¶æ¥å£ï¼Œè¯·å‹¿åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼ï¼ï¼ï¼‰
          serverUrl: '',//http://35.201.165.105:8000/controller.php
          // UEditor èµ„æºæ–‡ä»¶çš„å­˜æ”¾è·¯å¾„ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯ vue-cli ç”Ÿæˆçš„é¡¹ç›®ï¼Œé€šå¸¸ä¸éœ€è¦è®¾ç½®è¯¥é€‰é¡¹ï¼Œvue-ueditor-wrap ä¼šè‡ªåŠ¨å¤„ç†å¸¸è§çš„æƒ…å†µï¼Œå¦‚æœéœ€è¦ç‰¹æ®Šé…ç½®ï¼Œå‚è€ƒä¸‹æ–¹çš„å¸¸è§é—®é¢˜2
          // UEDITOR_HOME_URL: '/vue-editor/static/UEditor/'
        },
        baiduEdit2: {}
      }
    },
    methods: {
      // è·å–å®ä¾‹
      ready(editorInstance) {
        this.baiduEdit = editorInstance;
        // å±è”½Ctrl+Enterè‡ªåŠ¨æäº¤åŠŸèƒ½ï¼Œåœ¨formè¡¨å•æ ‡ç­¾ä¸‹é»˜è®¤ä¼šè‡ªåŠ¨æäº¤
        this.baiduEdit.commands.autosubmit.execCommand = function () {
        };

        console.log(`ç¼–è¾‘å™¨å®ä¾‹${editorInstance.key}: `, editorInstance)
      },
      // è·å–å®ä¾‹
      ready2(editorInstance) {
        // è®¾ç½®å¾®ä¿¡è¡¨æƒ…
        editorInstance.pageType = 'weChatPublic';
        this.baiduEdit2 = editorInstance;
        console.log(`ç¼–è¾‘å™¨å®ä¾‹${editorInstance.key}: `, editorInstance)
      },
      // è·å–å†…å®¹
      getContent() {
        console.log(this.msg)
        console.log(this.baiduEdit.getPlainTxt())

        console.log(`====================================================`)
        console.log(this.msg2)
        console.log(this.baiduEdit2.getPlainTxt())
        let nodeDom = this.baiduEdit2.body.childNodes[0].childNodes;
        let str = '';
        let num = 0;
        for (var i = 0; i < nodeDom.length; i++) {
          if (nodeDom[i].nodeType === 1 && (nodeDom[i].nodeName === 'SPAN' || nodeDom[i].nodeName === 'IMG')) {
            let imgs = nodeDom[i].attributes.src.value;
            // å¾®ä¿¡è§£æ
            if (imgs.indexOf('/wx/') >= 0) {
              let s = imgs.split('/');
              let ss = (s[s.length - 1].split('.')[0]).split('_')[1]
              let index = Number(ss);

              str += this.arr[index - 1];
              num += 2;  //ä¸€ä¸ªè¡¨æƒ…å ä¸¤ä¸ªé•¿åº¦
            } else {
              // éå¾®ä¿¡
              str += nodeDom[i].outerHTML
            }
          } else if (nodeDom[i].nodeType === 3) {    //æ–‡æœ¬èŠ‚ç‚¹
            str += nodeDom[i].nodeValue;
            num += nodeDom[i].nodeValue.length;
          } else if (nodeDom[i].nodeType === 1 && nodeDom[i].nodeName === 'DIV') {
            str += nodeDom[i].outerHTML;
          }
        }
        console.log(str)
      },
      // è‡ªå®šä¹‰æŒ‰é’®
      addCustomButtom(editorId) {
        window.UE.registerUI('test-button', function (editor, uiName) {
          // æ³¨å†ŒæŒ‰é’®æ‰§è¡Œæ—¶çš„ command å‘½ä»¤ï¼Œä½¿ç”¨å‘½ä»¤é»˜è®¤å°±ä¼šå¸¦æœ‰å›é€€æ“ä½œ
          editor.registerCommand(uiName, {
            execCommand: function () {
              editor.execCommand('inserthtml', `<span>è¿™æ˜¯ä¸€æ®µç”±è‡ªå®šä¹‰æŒ‰é’®æ·»åŠ çš„æ–‡å­—</span>`)
            }
          })

          // åˆ›å»ºä¸€ä¸ª button
          var btn = new window.UE.ui.Button({
            // æŒ‰é’®çš„åå­—
            name: uiName,
            // æç¤º
            title: 'é¼ æ ‡æ‚¬åœæ—¶çš„æç¤ºæ–‡å­—',
            // éœ€è¦æ·»åŠ çš„é¢å¤–æ ·å¼ï¼Œå¯æŒ‡å®š icon å›¾æ ‡ï¼Œå›¾æ ‡è·¯å¾„å‚è€ƒå¸¸è§é—®é¢˜ 2
            // cssRules: "background-image: url('/static/UEditor/themes/default/images/upload-img.png') !important;background-size: cover;",

            cssRules: "background-position: -380px 0px;",

            // ç‚¹å‡»æ—¶æ‰§è¡Œçš„å‘½ä»¤
            onclick: function () {
              // è¿™é‡Œå¯ä»¥ä¸ç”¨æ‰§è¡Œå‘½ä»¤ï¼Œåšä½ è‡ªå·±çš„æ“ä½œä¹Ÿå¯
              editor.execCommand(uiName)

              let btninput = document.createElement("input");
              btninput.name = "fileName";
              btninput.type = "file";
              btninput.multiple = "multiple";
              btninput.accept = ".png,.jpg";
              btninput.style = "display:none;";
              btninput.onchange = function (event) {
                let files = event.target.files;
                console.log(event, files)

                // æ‰‹åŠ¨ä¸Šä¼ å›¾ç‰‡

                // æ·»åŠ å›¾ç‰‡
                // editor.execCommand('inserthtml', `<img src="https://imgtest-1257418739.cos.ap-guangzhou.myqcloud.com/userFile/152/2019-05-14/3cf2139c-9148-440b-a284-d82a52717342.jpg" />`);

                document.body.removeChild(btninput)
              }
              document.body.appendChild(btninput);
              btninput.click();
            }
          })

          // å½“ç‚¹åˆ°ç¼–è¾‘å†…å®¹ä¸Šæ—¶ï¼ŒæŒ‰é’®è¦åšçš„çŠ¶æ€åå°„
          editor.addListener('selectionchange', function () {
            var state = editor.queryCommandState(uiName)
            if (state === -1) {
              btn.setDisabled(true)
              btn.setChecked(false)
            } else {
              btn.setDisabled(false)
              btn.setChecked(state)
            }
          })

          // å› ä¸ºä½ æ˜¯æ·»åŠ  buttonï¼Œæ‰€ä»¥éœ€è¦è¿”å›è¿™ä¸ª button
          return btn
        }, 0 /* æŒ‡å®šæ·»åŠ åˆ°å·¥å…·æ ä¸Šçš„å“ªä¸ªä½ç½®ï¼Œé»˜è®¤æ—¶è¿½åŠ åˆ°æœ€å */, editorId /* æŒ‡å®šè¿™ä¸ª UI æ˜¯å“ªä¸ªç¼–è¾‘å™¨å®ä¾‹ä¸Šçš„ï¼Œé»˜è®¤æ˜¯é¡µé¢ä¸Šæ‰€æœ‰çš„ç¼–è¾‘å™¨éƒ½ä¼šæ·»åŠ è¿™ä¸ªæŒ‰é’® */)
      },
      // è‡ªå®šä¹‰å¼¹çª—
      addCustomDialog(editorId) {
        window.UE.registerUI('test-dialog', function (editor, uiName) {
          // åˆ›å»º dialog
          var dialog = new window.UE.ui.Dialog({
            // æŒ‡å®šå¼¹å‡ºå±‚ä¸­é¡µé¢çš„è·¯å¾„ï¼Œè¿™é‡Œåªèƒ½æ”¯æŒé¡µé¢ï¼Œè·¯å¾„å‚è€ƒå¸¸è§é—®é¢˜ 2
            iframeUrl: '/wangEditor',
            // éœ€è¦æŒ‡å®šå½“å‰çš„ç¼–è¾‘å™¨å®ä¾‹
            editor: editor,
            // æŒ‡å®š dialog çš„åå­—
            name: uiName,
            // dialog çš„æ ‡é¢˜
            title: 'è¿™æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„ Dialog æµ®å±‚',
            // æŒ‡å®š dialog çš„å¤–å›´æ ·å¼
            cssRules: 'width:600px;height:300px;',
            // å¦‚æœç»™å‡ºäº† buttons å°±ä»£è¡¨ dialog æœ‰ç¡®å®šå’Œå–æ¶ˆ
            buttons: [
              {
                className: 'edui-okbutton',
                label: 'ç¡®å®š',
                onclick: function () {
                  dialog.close(true)
                }
              },
              {
                className: 'edui-cancelbutton',
                label: 'å–æ¶ˆ',
                onclick: function () {
                  dialog.close(false)
                }
              }
            ]
          })

          // å‚è€ƒä¸Šé¢çš„è‡ªå®šä¹‰æŒ‰é’®
          var btn = new window.UE.ui.Button({
            name: 'dialog-button',
            title: 'è‡ªå®šä¹‰å¼¹çª—',
            cssRules: "background-image: url('/static/UEditor/themes/default/images/upload-img.png') !important;background-size: cover;",
            onclick: function () {
              // æ¸²æŸ“dialog
              dialog.render()
              dialog.open()
            }
          })

          return btn
        }, 0 /* æŒ‡å®šæ·»åŠ åˆ°å·¥å…·æ ä¸Šçš„é‚£ä¸ªä½ç½®ï¼Œé»˜è®¤æ—¶è¿½åŠ åˆ°æœ€å */, editorId /* æŒ‡å®šè¿™ä¸ªUIæ˜¯å“ªä¸ªç¼–è¾‘å™¨å®ä¾‹ä¸Šçš„ï¼Œé»˜è®¤æ˜¯é¡µé¢ä¸Šæ‰€æœ‰çš„ç¼–è¾‘å™¨éƒ½ä¼šæ·»åŠ è¿™ä¸ªæŒ‰é’® */)
      }

    },
    mounted() {
      console.log(VueUeditorWrap, this.$refs)

      // å¾®ä¿¡è¡¨æƒ…
      this.arr.map((item, index) => {
        for (var i = 0; i < this.msg2.length; i++) {
          if (this.msg2.indexOf(item) != -1) {
            let idx = index > 8 ? index + 1 : '0' + (index + 1);
            let imgs = '/static/UEditor/dialogs/emotion/images/wx/wx_'
            let img = '<img src="' + imgs + idx + '.png" _src="' + imgs + idx + '.png" width="24" height="24" style="vertical-align: middle;">';
            this.msg2 = this.msg2.replace(item, img);
          }
        }
      });
    }
  }
</script>

<style>
  #edui1_imagescale {
    display: none !important;
  }

  /*å»é™¤ç‚¹å‡»å›¾ç‰‡åå‡ºç°çš„æ‹‰ä¼¸è¾¹æ¡†*/
  .edui-default .edui-editor {
    -webkit-border-radius: 0px !important;
    -moz-border-radius: 0px !important;
    border-radius: 0px !important;
  }

  .edui-default .edui-editor-toolbarbox {
    box-shadow: none !important;
    border-top-left-radius: 0px !important;
    border-top-right-radius: 0px !important;
  }

  .edui-default .edui-toolbar {
    padding: 5px !important;
    text-align: left;
  }

  /*è¡¨æƒ…å¼¹çª—*/
  .edui-default .edui-popup-content {
    -webkit-border-radius: 0px !important;
    -moz-border-radius: 0px !important;
    border-radius: 0px !important;
  }
</style>
<style scoped>
  .link-btns a {
    margin: 0px 5px;
  }
</style>
